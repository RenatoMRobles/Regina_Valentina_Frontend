<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regina Valentina | Experta en Mascotas</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6a1b9a">
    <meta name="description" content="Regina Valentina: La experta en comportamiento animal que pone orden en el rancho. Â¡Tus primeros 3 consejos son GRATIS! ğŸ¤ ğŸ¾">
    
    <meta property="og:title" content="Regina Valentina ğŸ¤ ğŸ¾ | Experta en Mascotas">
    <meta property="og:description" content="Â¿Tu mascota manda en casa? Platica con Regina y soluciona sus problemas hoy mismo.">
    <meta property="og:image" content="https://reginavalentina.com/ReginaValentinaRostro.png?v=2">
    <meta property="og:url" content="https://reginavalentina.com">
    <meta property="og:type" content="website">

    <style>
        @import url('https://fonts.cdnfonts.com/css/open-dyslexic');
        @import url('https://fonts.cdnfonts.com/css/gallaudet');

        body.dyslexia-mode * { font-family: 'OpenDyslexic', sans-serif !important; letter-spacing: 0.05em !important; }
        body.large-text-mode .message { font-size: 1.45rem !important; line-height: 1.6 !important; }
        body.large-text-mode input { font-size: 1.35rem !important; }
        body.large-text-mode .chip { font-size: 1.25rem !important; }

        body.high-contrast-mode { --bg-body: #000000 !important; --bg-chat: #000000 !important; --text-main: #ffffff !important; --header-bg: #000000 !important; --bot-bubble: #1a1a1a !important; --bot-text: #ffffff !important; --input-border: #ffff00 !important; }
        body.high-contrast-mode .header { border-bottom: 3px solid #ffff00; }
        body.high-contrast-mode button, body.high-contrast-mode .chip { border: 2px solid #ffff00 !important; color: #ffff00 !important; background: #000 !important; }
        body.high-contrast-mode .user-message { background-color: #ffff00 !important; color: #000000 !important; font-weight: bold; }
        body.high-contrast-mode a { color: #ffff00 !important; text-decoration: underline; }

        body.lsm-mode .message { font-family: 'Gallaudet', sans-serif !important; font-size: 2.2rem !important; line-height: 1.6 !important; }

        :root { --bg-body: #f4f4f9; --bg-chat: #ffffff; --text-main: #333333; --header-bg: #6a1b9a; --bot-bubble: #f1f0f0; --bot-text: #333333; --input-border: #ddd; }
        [data-theme="dark"] { --bg-body: #121212; --bg-chat: #1e1e1e; --text-main: #e0e0e0; --header-bg: #4a148c; --bot-bubble: #2d2d2d; --bot-text: #e0e0e0; --input-border: #444; }
        [data-theme="sepia"] { --bg-body: #f4ecd8; --bg-chat: #fdf6e3; --text-main: #5b4636; --header-bg: #8b6b61; --bot-bubble: #ede0c8; --bot-text: #4a3b32; --input-border: #d3c4a9; }

        .support-btn { position: fixed; bottom: 20px; right: 20px; background-color: #6a1b9a; border-radius: 50%; width: 55px; height: 55px; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 9999; transition: 0.3s; cursor:pointer; }
        .support-btn:hover { transform: scale(1.1); background-color: #ffca28; }

        .share-bubble { position: fixed; bottom: 85px; right: 20px; background: linear-gradient(145deg, #ff9800, #f57c00); border-radius: 50%; width: 55px; height: 55px; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 9999; transition: 0.3s; cursor:pointer; font-size:1.6rem; border:none; color:white; }
        .share-bubble:hover { transform: scale(1.1); background: #e65100; }

        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-body); color: var(--text-main); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; flex-direction: column; transition: background-color 0.3s ease; font-size: 1.15rem; }
        
        .chat-container { width: 95%; max-width: 750px; background: var(--bg-chat); border-radius: 12px; box-shadow: 0 5px 25px rgba(0,0,0,0.15); overflow: hidden; display: flex; flex-direction: column; height: 85vh; margin-bottom: 20px; margin-top: 15px; transition: background-color 0.3s ease; }
        
        .header { background-color: var(--header-bg); color: white; padding: 20px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 15px; position: relative; }
        .regina-avatar { width: 105px !important; height: 105px !important; min-width: 105px !important; min-height: 105px !important; border-radius: 50%; border: 3px solid white; object-fit: cover;}
        .header div { text-align: left; }
        .header h1 { margin: 0; font-size: 1.6em; }
        .header p { margin: 5px 0 0 0; font-size: 1.05em; opacity: 0.9; }

        #chat-box { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; scroll-behavior: smooth; }
        .message { max-width: 85%; padding: 14px 20px; border-radius: 20px; font-size: 1.20rem; line-height: 1.5; position: relative; word-wrap: break-word; white-space: pre-wrap; }
        .user-message { align-self: flex-end; background-color: #6a1b9a; color: white; border-bottom-right-radius: 2px; }
        .bot-message { align-self: flex-start; background-color: var(--bot-bubble); color: var(--bot-text); border-bottom-left-radius: 2px; }
        
        .input-area { padding: 15px 20px; border-top: 1px solid var(--input-border); display: flex; flex-direction: column; gap: 12px; background: var(--bg-chat); }
        .input-area input { font-size: 1.15rem; width: 100%; box-sizing: border-box; padding: 12px; background: var(--bg-body); color: var(--text-main); border: 1px solid var(--input-border); border-radius: 20px; outline: none; }
        .input-controls { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .input-icons { display: flex; gap: 15px; }
        .input-controls button.btn-enviar { font-size: 1.15rem; padding: 10px 25px; background-color: #6a1b9a; color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; }
        
        .pdf-btn { display: block; margin-top: 10px; background: #e91e63; color: white; text-align: center; padding: 8px 12px; border-radius: 5px; font-size: 1rem; text-decoration: none; cursor: pointer; width: fit-content; }
        .loading { font-style: italic; color: #888; font-size: 1rem; margin-left: 20px; margin-bottom: 10px; display: none; }
        .footer { text-align: center; font-size: 0.9rem; color: #777; padding: 20px; width: 100%; max-width: 700px; }
        
        .chips-container { display: flex; gap: 10px; padding: 12px 15px; overflow-x: auto; white-space: nowrap; scrollbar-width: none; background: var(--bg-chat); }
        .chip { background-color: var(--bg-body); border: 2px solid #6a1b9a; color: var(--text-main); padding: 10px 18px; border-radius: 20px; font-size: 1.05rem; font-weight: bold; cursor: pointer; white-space: nowrap; }
        
        @keyframes latidoVictoria { 0% { transform: scale(1); } 50% { transform: scale(1.8); filter: drop-shadow(0 0 25px #ffca28); } 100% { transform: scale(1); } }
        .animar-victoria { animation: latidoVictoria 0.8s ease-in-out 3; }

        #membrete-pdf, #reporte-cientifico-pdf { display: none; }
        
        @media print {
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            .header, .input-area, .chips-container, button, .pdf-btn, footer, .footer, #caja-aviso-legal, .support-btn, .share-bubble, #trofeo-badge, #vitrina-modal { display: none !important; }
            body > p, body > div > p { display: none !important; }
            
            body, html { background: white !important; width: 100% !important; height: auto !important; margin: 0 !important; padding: 0 !important; }
            
            .printable-guide { display: block !important; background: transparent !important; box-shadow: none !important; margin-bottom: 20px !important; font-family: 'Georgia', 'Times New Roman', serif !important; font-size: 13pt !important; line-height: 1.8 !important; text-align: justify !important; }
            #membrete-pdf { display: block !important; text-align: center; margin-bottom: 30px; page-break-after: avoid; }
            
            #reporte-cientifico-pdf { display: block !important; text-align: center; font-family: 'Segoe UI', sans-serif !important; padding: 40px !important; border: 10px solid #6a1b9a !important; border-radius: 20px !important; background: #fffaf0 !important; }
            #reporte-cientifico-pdf h1 { color: #6a1b9a !important; font-size: 35px !important; margin-bottom: 5px !important; text-transform: uppercase !important; }
            #reporte-cientifico-pdf h2 { color: #ff9800 !important; font-size: 24px !important; border-bottom: 2px solid #ff9800 !important; padding-bottom: 10px !important; }
            #reporte-cientifico-pdf .insignia-print { display: inline-block; padding: 15px; margin: 10px; border: 2px solid #6a1b9a; border-radius: 15px; background: white; width: 40%; vertical-align: top; }
            #reporte-cientifico-pdf .insignia-print h3 { margin: 5px 0; color: #333; }
            #reporte-cientifico-pdf .insignia-print p { font-size: 12px; color: #555; text-align: justify; }
            
            #chat-box { display: none !important; } 
        }
    </style>
</head>
<body>

<div id="auth-modal" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:3000; justify-content:center; align-items:center; display:none;">
    <div style="background:white; padding:40px; border-radius:15px; width:85%; max-width:320px; text-align:center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); position:relative;">
        <button onclick="document.getElementById('auth-modal').style.display='none'; vibrar(30);" style="position:absolute; top:10px; right:15px; background:none; border:none; font-size:2em; color:#999; cursor:pointer;">Ã—</button>
        <img src="ReginaValentinaRostro.png?v=2" alt="Regina" style="width:90px; height:90px; border-radius:50%; margin-bottom:15px; border:3px solid #6a1b9a; object-fit: cover;">
        <h2 id="auth-title" style="color:#6a1b9a; margin-top:0;">Acceso VIP ğŸ¤ </h2>
        
        <div id="auth-inputs">
            <input type="email" id="auth-email" placeholder="Correo electrÃ³nico" style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ddd; border-radius:8px; box-sizing:border-box; font-size:1.1rem;">
            <input type="password" id="auth-password" placeholder="ContraseÃ±a" style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ddd; border-radius:8px; box-sizing:border-box; font-size:1.1rem;">
            
            <div style="text-align: left; margin-bottom: 20px; width: 100%;">
                <label style="font-size: 0.95em; color: #555; display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="auth-terminos" style="width: 20px; height: 20px; cursor: pointer;">
                    <span>Acepto los <a href="terminos.html" target="_blank" style="color: #6a1b9a; text-decoration: underline;">TÃ©rminos y Condiciones</a></span>
                </label>
            </div>

            <button onclick="vibrar(40); ejecutarLogin();" style="width:100%; padding:14px; background-color:#6a1b9a; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer; margin-bottom:10px; font-size:1.1rem;">Iniciar SesiÃ³n</button>
            <button onclick="vibrar(40); ejecutarRegistro();" style="width:100%; padding:14px; background-color:#fff; color:#6a1b9a; border:2px solid #6a1b9a; border-radius:8px; font-weight:bold; cursor:pointer; font-size:1.1rem;">Crear Cuenta Nueva</button>
        </div>

        <div id="logged-in-view" style="display:none; text-align:center;">
            <p style="color:#555; font-size:1.1em; margin-bottom:20px;">Usted ya es parte del rancho. Â¡Su acceso estÃ¡ asegurado!</p>
            <button id="btn-centro-mando" onclick="vibrar(40); window.open('https://RenatoRobles.pythonanywhere.com/panel-robles?admin_id=' + getUserId(), '_blank')" style="display:none; width:100%; padding:14px; background-color:#1e1e1e; color:#ffca28; border:2px solid #ffca28; border-radius:8px; font-weight:bold; cursor:pointer; margin: 0 auto 15px auto; font-size:1.1rem;">ğŸ¦… Centro de Mando</button>
            <button onclick="vibrar(40); cerrarSesion();" style="width:100%; padding:14px; background-color:#f44336; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer; margin: 0 auto; font-size:1.1rem;">Cerrar SesiÃ³n ğŸšª</button>
            
            <div style="background: rgba(106, 27, 154, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px dashed #6a1b9a; margin-top:20px;">
                <p style="margin-top:0; font-size:1em; color:#333; font-weight:bold;">ğŸŸï¸ Â¿Tienes un cÃ³digo promocional?</p>
                <div style="display:flex; flex-direction:column; gap:10px;">
                    <input type="text" id="input-cupon" placeholder="Ej. ROBLESVIP" style="width:100%; padding:12px; border:1px solid #ccc; border-radius:5px; text-transform:uppercase; font-size:1rem; box-sizing:border-box;">
                    <button onclick="vibrar(40); canjearCupon();" style="width:100%; background:#6a1b9a; color:white; border:none; padding:12px; border-radius:5px; font-weight:bold; cursor:pointer; font-size:1rem;">Canjear CupÃ³n</button>
                </div>
            </div>
        </div>
        <p id="auth-error" style="color:red; font-size:1rem; margin-top:15px; min-height:20px;"></p>
    </div>
</div>

<div id="vitrina-modal" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:2000; justify-content:center; align-items:center; display:none;">
    <div class="modal-content" style="background:white; padding:30px; border-radius:15px; width:90%; max-width:420px; text-align:center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); position:relative; border-top: 6px solid #ffca28; max-height:85vh; overflow-y:auto;">
        
        <div id="vista-principal-vitrina">
            <button onclick="document.getElementById('vitrina-modal').style.display='none'; vibrar(30);" style="position:absolute; top:10px; right:15px; background:none; border:none; font-size:2em; color:#999; cursor:pointer;">Ã—</button>
            <h2 style="color:#6a1b9a; margin-top:0;">ğŸ† Tu Vitrina de Logros</h2>
            <button onclick="vibrar(30); abrirGuiaEstrellas()" style="background:#e8eaf6; color:#3f51b5; border:1px solid #3f51b5; padding:10px 18px; border-radius:20px; font-weight:bold; cursor:pointer; margin-bottom:15px; font-size:1rem;">ğŸ“– GuÃ­a Explicativa</button>
            <div id="lista-trofeos" style="text-align:left;"></div>
            <div id="contenedor-maximo" style="margin-top: 15px;"></div>
        </div>

        <div id="vista-detalle-vitrina" style="display:none;"></div>
        <div id="vista-guia-vitrina" style="display:none;"></div>
    </div>
</div>

<div id="feedback-modal" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:2000; justify-content:center; align-items:center; display:none;">
    <div style="background:white; padding:30px; border-radius:15px; width:85%; max-width:320px; text-align:center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); position:relative; border-top: 6px solid #ffca28;">
        <button onclick="document.getElementById('feedback-modal').style.display='none'; vibrar(60);" style="position:absolute; top:10px; right:15px; background:none; border:none; font-size:2em; color:#999; cursor:pointer;">Ã—</button>
        <h2 style="color:#6a1b9a; margin-top:0;">ğŸ’¡ BuzÃ³n del Rancho</h2>
        <textarea id="feedback-texto" rows="4" placeholder="Escriba aquÃ­ su mensaje..." style="width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; box-sizing:border-box; resize:none; margin-bottom:15px; font-family:inherit; font-size:1.05rem;"></textarea>
        <button id="btn-enviar-sug" onclick="vibrar(40); enviarSugerencia();" style="width:100%; padding:14px; background-color:#ffca28; color:#333; border:none; border-radius:8px; font-weight:bold; cursor:pointer; font-size:1.1rem;">Enviar Mensaje ğŸš€</button>
    </div>
</div>

<div id="membrete-pdf">
    <h1 style="font-size: 24px; margin-bottom: 5px;">ğŸ¾ Robles Bienestar</h1>
    <h3 style="margin-top: 0; color: #ffca28; letter-spacing: 2px;">REPORTE OFICIAL DE COMPORTAMIENTO</h3>
    <hr style="border: 1px solid #ffca28; margin-bottom: 20px;">
</div>

<div id="reporte-cientifico-pdf"></div>

<div id="trofeo-badge" onclick="vibrar(40); abrirVitrina()" title="Ver mis medallas" style="position:fixed; top:20px; right:20px; z-index:1900; background:linear-gradient(145deg, #fff8e1, #ffecb3); border:2px solid #ffca28; padding:8px 15px; border-radius:25px; box-shadow:0 4px 10px rgba(0,0,0,0.2); font-size:1.3em; display:none; align-items:center; gap:8px; font-weight:bold; color:#333; cursor:pointer; transition:0.3s;">
    ğŸŒŸ <span id="trofeo-count">0/5</span>
</div>

<div class="chat-container">
   <div class="header">
        <img src="ReginaValentinaRostro.png?v=2" alt="Regina Valentina" class="regina-avatar">
        <div>
            <h1>Regina Valentina ğŸ¤ ğŸ¾</h1>
            <p>Experta en Comportamiento</p>
            <div style="display: flex; gap: 12px; margin-top:10px;">
                <button id="btn-header-voice" style="background:rgba(255,255,255,0.2); border-radius:50%; width:46px; height:46px; display:flex; justify-content:center; align-items:center; color:#ffeb3b; padding:0; transition: 0.3s; border:none; cursor:pointer;" onclick="vibrar(30); togglePremiumVoice()">
                    <div style="display:flex; flex-direction:column; align-items:center; line-height:1.1;"><span style="font-size:1.2rem;">ğŸ—£ï¸</span><span style="font-size:0.65rem;">ğŸ’</span></div>
                </button>
                <button style="background:rgba(255,255,255,0.2); border-radius:50%; width:46px; height:46px; display:flex; justify-content:center; align-items:center; padding:0; transition: 0.3s; border:none; cursor:pointer; color:white; font-size:1.4rem;" onclick="vibrar(30); toggleTheme()">ğŸŒ™</button>
                <button style="background:rgba(255,255,255,0.2); border-radius:50%; width:46px; height:46px; display:flex; justify-content:center; align-items:center; padding:0; transition: 0.3s; border:none; cursor:pointer; color:white; font-size:1.4rem;" onclick="vibrar(30); abrirMiCuenta()">ğŸ‘¤</button>
                <button style="background:rgba(255,255,255,0.2); border-radius:50%; width:46px; height:46px; display:flex; justify-content:center; align-items:center; padding:0; transition: 0.3s; border:none; cursor:pointer; color:white; font-size:1.4rem;" onclick="vibrar(30); document.getElementById('settings-modal').style.display='flex'">âš™ï¸</button>
            </div>
        </div>
    </div>
    
    <div id="chat-box">
        <div class="message bot-message">
            Â¡Hola! Soy Regina Valentina. CuÃ©ntame, Â¿quÃ© problema traes con tu mascota? Habla claro y <strong>adjunta una foto ğŸ“· de tu peludo o del problema</strong> para entender mejor tu caso.
        </div>
    </div>
    <div class="loading" id="loading">Regina estÃ¡ escribiendo...</div>

    <div class="chips-container">
        <button class="chip" onclick="vibrar(40); sendChip('Quiero jugar con la Miss Regina')">ğŸ® Juguemos</button>
        <button class="chip" onclick="vibrar(40); sendChip('Miss Regina, ya hice la tarea')" style="background:#e8f5e9; border-color:#4caf50; color:#2e7d32;">âœ… Ya hice la tarea</button>
        <button class="chip" onclick="vibrar(40); sendChip('ğŸ§ Â¡AnalÃ­zame Regina!')">ğŸ§ AnalÃ­zame</button>
        <button class="chip" onclick="vibrar(40); sendChip('ğŸ¤  Â¿CÃ³mo educar a un perro latoso?')">ğŸ¤  Educar perro latoso</button>
        <button class="chip" onclick="vibrar(40); sendChip('ğŸ  Â¿CÃ³mo evitar que se orine adentro?')">ğŸ  PipÃ­ en casa</button>
        <button class="chip" onclick="vibrar(60); dispararEmergencia()" style="border-color:#d32f2f; color:#d32f2f;">ğŸ§‘â€âš•ï¸ Urgencia</button>
    </div>

    <div class="input-area">
        <input type="text" id="user-input" placeholder="Escribe tu consulta aquÃ­...">
        <div class="input-controls">
            <div class="input-icons">
                <button id="mic-toggle" onclick="vibrar(30); toggleMic()" style="background:none; border:none; font-size:1.8em; cursor:pointer; padding: 0; transition: 0.3s;">ğŸ¤</button>
                <input type="file" id="input-foto-chat" accept="image/*" style="display:none;" onchange="previsualizarFotoChat()">
                <button id="btn-camara" onclick="vibrar(30); document.getElementById('input-foto-chat').click()" style="background:none; border:none; font-size:1.8em; cursor:pointer; padding: 0; transition: 0.3s;">ğŸ“·</button>
            </div>
            <button class="btn-enviar" onclick="vibrar(50); sendMessage()">Enviar</button>
        </div>
    </div>
</div> 

<script>
    const API_URL = 'https://RenatoRobles.pythonanywhere.com';

    let voiceEnabled = false;
    let premiumVoiceEnabled = true; 
    let reginaVoice = null;
    let audioPremiumActual = null;
    let dyslexiaEnabled = false;
    let lsmEnabled = false;

    function vibrar(patron) {
        if ("vibrate" in navigator) { try { navigator.vibrate(patron); } catch(e) {} }
    }

    function compartirApp() {
        if (navigator.share) {
            navigator.share({ title: 'Regina Valentina ğŸ¤ ğŸ¾', text: 'Â¡Conoce a Regina Valentina, la experta en mascotas con IA!', url: 'https://reginavalentina.com' }).catch(console.error);
        } else {
            navigator.clipboard.writeText("https://reginavalentina.com");
            mostrarNotificacion("ğŸ”— Â¡Enlace copiado al portapapeles!", "#4caf50");
        }
    }

    // ğŸ‘‡ TEXTOS DE LA VITRINA PURIFICADOS ğŸ‘‡
    const trofeosConfig = [
        { id: 'lider', color: "ğŸŸ¢", icono:"ğŸº", hex: "#4caf50", nombre: "LÃ­der de la Manada", max: 100, desc: "Â¡Felicidades, pariente! AquÃ­ demuestras quiÃ©n lleva las riendas del rancho, pero con puro respeto, sin gritos ni manotazos. Tu mascota ya te ve como el jefe de la manada." },
        { id: 'zen', color: "ğŸ”µ", icono:"ğŸ§˜", hex: "#2196f3", nombre: "Maestro Zen", max: 100, desc: "Â¡QuÃ© chulada! Se acabÃ³ el relajo en casa. Tu perrito le bajÃ³ dos rayitas a su estrÃ©s y ahora respira pura paz. Â¡Parece monje tibetano!" },
        { id: 'autocontrol', color: "ğŸ”´", icono:"ğŸ›‘", hex: "#f44336", nombre: "Autocontrol", max: 100, desc: "Â¡Epa! Tu mascota domina sus impulsos. Sabe esperar su turno para comer o salir sin volverse loco. Â¡Un verdadero caballero o damita!" },
        { id: 'atleta', color: "ğŸŸ ", icono:"ğŸƒ", hex: "#ff9800", nombre: "Atleta Perruno", max: 100, desc: "Â¡Fierro! Tienen la energÃ­a bien canalizada. Actividad fÃ­sica al cien, mente sana y cuerpo cansado pa' dormir a gusto toda la noche." },
        { id: 'socio', color: "ğŸŒŸ", icono:"ğŸ¤", hex: "#ffeb3b", nombre: "Socio Supremo", max: 100, desc: "Â¡Mis respetos! La conexiÃ³n entre ustedes es de otro nivel. Ya ni ocupan palabras, nomÃ¡s con una mirada se entienden. Son la dupla envidia del condado." }
    ];

    function calcularProgreso(puntos, max) {
        if (puntos <= 0) return 0;
        if (puntos >= max) return 100;
        return Math.floor((puntos / max) * 100);
    }

    function contarInsignias() {
        let count = 0;
        trofeosConfig.forEach(t => {
            let pts = parseInt(localStorage.getItem('regina_pts_' + t.id) || 0);
            if (calcularProgreso(pts, t.max) === 100) count++;
        });
        return count;
    }

    function abrirVitrina() {
        document.getElementById('vista-principal-vitrina').style.display = 'block';
        document.getElementById('vista-detalle-vitrina').style.display = 'none';
        document.getElementById('vista-guia-vitrina').style.display = 'none';
        
        const lista = document.getElementById('lista-trofeos');
        let html = "";
        let totalInsignias = contarInsignias();

        trofeosConfig.forEach((t, index) => {
            let ptsActuales = parseInt(localStorage.getItem('regina_pts_' + t.id) || 0);
            let progreso = calcularProgreso(ptsActuales, t.max);
            
            let bloqueado = progreso === 0 ? "filter: grayscale(100%); opacity: 0.6;" : "box-shadow: 0 4px 6px rgba(0,0,0,0.1);";
            let colorPorcentaje = progreso === 100 ? t.hex : "#777";
            
            let badgeInsignia = progreso === 100 ? `<div style="background:#ffca28; color:#333; padding:2px 8px; border-radius:10px; font-size:0.7em; font-weight:bold; display:inline-block; margin-top:5px; border:1px solid #d8a000;">ğŸŒŸ Insignia Obtenida</div>` : `<p style="margin:3px 0 0 0; font-size:0.85em; color:#888;">Nivel de Progreso:</p>`;

            html += `<div onclick="vibrar(30); verDetalleTrofeo(${index})" style="display:flex; align-items:center; gap:15px; margin-bottom:12px; padding:15px; background:#f9f9f9; border-radius:12px; border: 1px solid #eee; cursor:pointer; transition: 0.3s; ${bloqueado}">
                <span style="font-size:2.2em;">${t.icono}</span>
                <div style="text-align:left; flex:1;">
                    <h4 style="margin:0; color:#333; font-size:1.1em;">${t.nombre}</h4>
                    ${badgeInsignia}
                </div>
                <div style="font-size:1.2em; color:${colorPorcentaje}; font-weight:bold;">${progreso}%</div>
            </div>`;
        });
        lista.innerHTML = html;

        const contenedorMaximo = document.getElementById('contenedor-maximo');
        if(totalInsignias === 5) {
            contenedorMaximo.innerHTML = `<div onclick="vibrar(80); verLeyenda()" style="background: linear-gradient(145deg, #ffd54f, #ff8f00); padding: 20px; border-radius: 15px; margin-top: 20px; color: white; cursor: pointer; box-shadow: 0 5px 15px rgba(255, 143, 0, 0.4); transition:0.3s;">
                <h3 style="margin:0; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); font-size:1.3em;">ğŸ‘‘ LA CIMA DE LA MONTAÃ‘A</h3>
                <p style="margin:5px 0 0 0; font-weight:bold; font-size:0.95em;">Â¡Desbloqueado! Toca para abrir tu recompensa.</p>
            </div>`;
        } else {
            contenedorMaximo.innerHTML = `<div style="background: #eee; padding: 20px; border-radius: 15px; margin-top: 20px; color: #757575; border: 2px dashed #ccc;">
                <h3 style="margin:0; font-size:1.2em;">â›°ï¸ Cima de la MontaÃ±a</h3>
                <p style="margin:5px 0 0 0; font-size:0.9em;">Consigue las 5 Insignias para ver el premio final.</p>
            </div>`;
        }
        document.getElementById('vitrina-modal').style.display = 'flex';
    }

    function verDetalleTrofeo(index) {
        let t = trofeosConfig[index];
        let ptsActuales = parseInt(localStorage.getItem('regina_pts_' + t.id) || 0);
        let progreso = calcularProgreso(ptsActuales, t.max);

        document.getElementById('vista-principal-vitrina').style.display = 'none';
        const vistaDetalle = document.getElementById('vista-detalle-vitrina');
        
        let mensajeFelicidades = progreso === 100 ? `<div style="background:#fff8e1; border:2px solid #ffca28; padding:10px; border-radius:10px; margin-top:15px; color:#d8a000; font-weight:bold;">Â¡Felicidades! Has obtenido la Insignia de Buen Pastor ğŸŒŸ.</div>` : ``;

        vistaDetalle.innerHTML = `
            <div style="text-align:left; margin-bottom:15px;">
                <button onclick="vibrar(30); abrirVitrina()" style="background:none; border:none; color:#d81b60; font-weight:bold; font-size:1.1em; cursor:pointer;">â¬… Volver</button>
            </div>
            <span style="font-size:4.5em; filter:drop-shadow(0 4px 6px rgba(0,0,0,0.2));">${t.icono}</span>
            <h2 style="color:${t.hex}; margin:10px 0;">${t.nombre}</h2>
            
            <div style="background:#f4f4f9; padding:20px; border-radius:12px; margin:20px 0; border-left: 5px solid ${t.hex}; text-align:left;">
                <p style="margin:0; font-style:italic; color:#555; font-size:1.1em;">"${t.desc}"</p>
                <p style="margin:10px 0 0 0; font-weight:bold; color:#333; text-align:right;">- Regina Valentina ğŸ¤ </p>
            </div>

            <div style="margin-top:25px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:8px; font-weight:bold; color:#333;">
                    <span>Tu Nivel:</span>
                    <span style="color:${t.hex}; font-size:1.3em;">${progreso}%</span>
                </div>
                <div style="background:#e0e0e0; border-radius:25px; padding:4px; box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);">
                    <div style="background: linear-gradient(90deg, ${t.hex}, #333); width: ${progreso}%; height: 26px; border-radius: 20px; transition: width 1s cubic-bezier(0.25, 1, 0.5, 1);"></div>
                </div>
                <p style="color:#777; font-size:0.9em; margin-top:10px;">Tienes ${ptsActuales} pts. Gana <b>${t.max} pts</b> en total para dominar esta habilidad.</p>
                ${mensajeFelicidades}
            </div>
        `;
        vistaDetalle.style.display = 'block';
    }

    function verLeyenda() {
        document.getElementById('vista-principal-vitrina').style.display = 'none';
        const vistaDetalle = document.getElementById('vista-detalle-vitrina');
        vistaDetalle.innerHTML = `
            <div style="text-align:left; margin-bottom:15px;">
                <button onclick="vibrar(30); abrirVitrina()" style="background:none; border:none; color:#d81b60; font-weight:bold; font-size:1.1em; cursor:pointer;">â¬… Volver</button>
            </div>
            <span style="font-size:5.5em; filter:drop-shadow(0 0 25px #ffca28);">ğŸ‘‘</span>
            <h2 style="color:#ff8f00; margin:10px 0; font-size:1.8em;">Leyenda del Rancho</h2>
            
            <div style="background:#fff8e1; padding:20px; border-radius:12px; margin:20px 0; border: 2px solid #ffca28; text-align:left;">
                <p style="margin:0; font-style:italic; color:#333; font-size:1.15em;">"Â¡Mis respetos, pariente! Has obtenido las 5 Insignias de Buen Pastor. TÃº y tu mascota son la dupla perfecta."</p>
                <p style="margin:10px 0 0 0; font-weight:bold; color:#d81b60; text-align:right;">- Regina Valentina ğŸ¤ </p>
            </div>
            <p style="font-weight:bold; color:#4caf50; font-size:1.1em; margin-bottom: 20px;">Â¡Completado al 100%! ğŸ”ï¸</p>

            <button onclick="vibrar(60); generarReporteCientifico()" style="width:100%; background:#6a1b9a; color:white; border:none; padding:15px; border-radius:30px; font-weight:bold; font-size:1.1em; cursor:pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.2);">ğŸ“„ Descargar Reporte</button>
            <p style="color:#888; font-size:0.8em; margin-top:10px;">* El reporte avanzado estarÃ¡ en la Fase GCP. Por ahora, disfruta de tu AcreditaciÃ³n.</p>
        `;
        vistaDetalle.style.display = 'block';
    }

    function generarReporteCientifico() {
        let nombreMascota = prompt("Â¡Felicidades! Ingresa el nombre de tu mascota para el reporte:", "Mi Mascota");
        if (!nombreMascota) return;

        let fecha = new Date().toLocaleDateString('es-MX');
        let divReporte = document.getElementById('reporte-cientifico-pdf');
        
        let insigniasHTML = "";
        trofeosConfig.forEach(t => {
            insigniasHTML += `
            <div class="insignia-print">
                <span style="font-size: 40px;">${t.icono} ğŸŒŸ</span>
                <h3>${t.nombre}</h3>
                <p>Nivel 100% Alcanzado. ${t.desc}</p>
            </div>`;
        });

        divReporte.innerHTML = `
            <p style="color:#777; margin-bottom:20px; font-weight:bold;">FECHA DE EMISIÃ“N: ${fecha}</p>
            <h1>ACREDITACIÃ“N DE CONDUCTA ANIMAL</h1>
            <p style="font-size: 18px; color: #333;">Se certifica que el binomio formado por el usuario y su mascota:</p>
            <h2 style="font-size: 30px; color: #d81b60; margin: 10px 0;">ğŸ¾ ${nombreMascota.toUpperCase()} ğŸ¾</h2>
            <p style="font-size: 18px; color: #333; margin-bottom: 30px;">Han completado el programa, obteniendo las 5 Insignias de Buen Pastor.</p>
            <div style="text-align: center; margin-bottom: 40px;">${insigniasHTML}</div>
            <p style="font-style: italic; color: #555; margin-top: 50px;">"El verdadero liderazgo no requiere fuerza, sino entendimiento."</p>
            <br><br><p>_____________________________________</p>
            <p style="font-weight: bold; margin-top:5px;">Regina Valentina</p>
        `;
        
        setTimeout(() => { window.print(); }, 500);
    }

    function abrirGuiaEstrellas() {
        document.getElementById('vista-principal-vitrina').style.display = 'none';
        const vistaGuia = document.getElementById('vista-guia-vitrina');
        vistaGuia.innerHTML = `
            <div style="text-align:left; margin-bottom:15px;">
                <button onclick="vibrar(30); abrirVitrina()" style="background:none; border:none; color:#d81b60; font-weight:bold; font-size:1.1em; cursor:pointer;">â¬… Volver</button>
            </div>
            <h2 style="color:#6a1b9a;">ğŸ“– GuÃ­a Explicativa</h2>
            <div style="text-align:left; color:#444; font-size:1.1em; line-height:1.6; background:#f9f9f9; padding:20px; border-radius:12px; border:1px solid #eee;">
                <p><strong>1. Pide un consejo:</strong> Platica con Regina sobre cualquier problema.</p>
                <p><strong>2. GÃ¡nate los Puntos:</strong> Regina te dejarÃ¡ una 'Tarea' y te dirÃ¡ cuÃ¡ntos puntos vale.</p>
                <p><strong>3. Cobra tu premio:</strong> Cuando la termines, presiona <b>"âœ… Ya hice la tarea"</b>.</p>
                <p><strong>4. Las Insignias ğŸŒŸ:</strong> Al llegar al 100% en una habilidad, te ganas una "Insignia de Buen Pastor".</p>
                <p><strong>5. La Cima:</strong> Â¡Junta las 5 Insignias para ser la Leyenda del Rancho!</p>
            </div>
            <button onclick="vibrar(30); abrirVitrina()" style="width:100%; margin-top:20px; padding:14px; background:#6a1b9a; color:white; border:none; border-radius:8px; font-weight:bold; font-size:1.15em; cursor:pointer;">Â¡Entendido, a darle!</button>
        `;
        vistaGuia.style.display = 'block';
    }

    function celebrarInsigniaNueva() {
        vibrar([100, 50, 100, 50, 300, 100, 500]);
        mostrarNotificacion("ğŸ‰ Â¡NUEVA INSIGNIA DE BUEN PASTOR DESBLOQUEADA! ğŸ‰<br>Revisa tu Vitrina.", "#ffca28", 6000);
        const badge = document.getElementById('trofeo-badge');
        badge.classList.remove('animar-victoria');
        void badge.offsetWidth; 
        badge.classList.add('animar-victoria');
    }

    function actualizarInsigniasVisuales(puntos) {
        if (!puntos) return;
        localStorage.setItem('regina_pts_lider', puntos.lider);
        localStorage.setItem('regina_pts_zen', puntos.zen);
        localStorage.setItem('regina_pts_autocontrol', puntos.autocontrol);
        localStorage.setItem('regina_pts_atleta', puntos.atleta);
        localStorage.setItem('regina_pts_socio', puntos.socio);

        let insigniasNuevas = contarInsignias();
        let insigniasViejas = parseInt(localStorage.getItem('regina_total_insignias') || 0);

        localStorage.setItem('regina_total_insignias', insigniasNuevas);

        const badge = document.getElementById('trofeo-badge');
        const count = document.getElementById('trofeo-count');
        
        badge.style.display = 'flex';
        count.innerText = insigniasNuevas + "/5";
        
        if (insigniasNuevas > insigniasViejas) { celebrarInsigniaNueva(); }
    }

    function silenciarAviso(texto) {
        let txt = texto;
        if(txt.includes("Aviso:")) { txt = txt.split("Aviso:")[0]; }
        return txt.replace(/[*_#]/g, '');
    }

    function toggleDyslexia() {
        dyslexiaEnabled = !dyslexiaEnabled;
        const body = document.body;
        const btnModal = document.getElementById('btn-config-dyslexia');
        if (dyslexiaEnabled) {
            if (lsmEnabled) toggleLSM();
            body.classList.add('dyslexia-mode');
            if(btnModal) { btnModal.style.background = '#e8f5e9'; btnModal.style.borderColor = '#4caf50'; } 
            mostrarNotificacion("ğŸ‘“ Lectura cÃ³moda habilitada", "#4caf50"); 
        } else {
            body.classList.remove('dyslexia-mode');
            if(btnModal) { btnModal.style.background = '#f4f4f9'; btnModal.style.borderColor = '#ddd'; } 
            mostrarNotificacion("Lectura estÃ¡ndar restaurada", "#6a1b9a");
        }
    }

    function quitarAcentos(texto) { return texto.normalize("NFD").replace(/[\u0300-\u036f]/g, ""); }
    
    function copiarConsejo(elementoId) {
        vibrar(60);
        let clon = document.getElementById(elementoId).cloneNode(true);
        let botones = clon.querySelectorAll('button, div');
        botones.forEach(b => b.remove()); 
        navigator.clipboard.writeText(clon.innerText.trim());
        mostrarNotificacion("ğŸ“‹ Â¡Consejo copiado al portapapeles!", "#d81b60");
    }
    
    let ultimoMensajeLeido = null;
    function reproducirMensaje(msgId) {
        vibrar(60);
        if (typeof audioPremiumActual !== 'undefined' && audioPremiumActual) { audioPremiumActual.pause(); }
        if (window.speechSynthesis.speaking && ultimoMensajeLeido === msgId) {
            window.speechSynthesis.cancel();
            ultimoMensajeLeido = null;
            return;
        }

        window.speechSynthesis.cancel();
        ultimoMensajeLeido = msgId;

        const elemento = document.getElementById(msgId);
        let textoPuro = elemento.getAttribute('data-puretext') || elemento.innerText;
        let textoLimpio = silenciarAviso(textoPuro);
        
        const utterance = new SpeechSynthesisUtterance(textoLimpio);
        if (reginaVoice) utterance.voice = reginaVoice;
        utterance.lang = 'es-MX'; utterance.rate = 1.05; 
        
        utterance.onend = function() { if (ultimoMensajeLeido === msgId) ultimoMensajeLeido = null; };
        
        window.speechSynthesis.speak(utterance);
        mostrarNotificacion("ğŸ”Š Leyendo... (Click en el mismo botÃ³n para detener)", "#2196f3", 3500);
    }
    
    window.addEventListener('beforeunload', function() {
        window.speechSynthesis.cancel();
        if (typeof audioPremiumActual !== 'undefined' && audioPremiumActual) audioPremiumActual.pause();
    });

    function toggleLSM() {
        lsmEnabled = !lsmEnabled;
        const body = document.body;
        const chatBox = document.getElementById('chat-box');
        const messages = document.querySelectorAll('.message');

        if (lsmEnabled) {
            if (dyslexiaEnabled) toggleDyslexia();
            body.classList.add('lsm-mode');
            messages.forEach(msg => {
                if (!msg.hasAttribute('data-original')) { msg.setAttribute('data-original', msg.innerHTML); }
                msg.innerHTML = quitarAcentos(msg.innerHTML);
            });
            mostrarNotificacion("ğŸ¤Ÿ Modo DactilologÃ­a Activado", "#d81b60");
            chatBox.scrollTop = chatBox.scrollHeight;
        } else {
            body.classList.remove('lsm-mode');
            messages.forEach(msg => {
                if (msg.hasAttribute('data-original')) { msg.innerHTML = msg.getAttribute('data-original'); }
            });
        }
    }
    
    function mostrarNotificacion(texto, colorFondo = "#6a1b9a", tiempo = 4500) {
        const noti = document.createElement('div');
        noti.style.cssText = `position:fixed; top:20px; left:50%; transform:translateX(-50%); background:${colorFondo}; color:white; padding:12px 24px; border-radius:30px; z-index:9999; box-shadow:0 4px 15px rgba(0,0,0,0.4); font-weight:bold; font-size:1.05em; transition: opacity 0.5s; text-align:center;`;
        noti.innerHTML = texto;
        document.body.appendChild(noti);
        setTimeout(() => {
            noti.style.opacity = '0';
            setTimeout(() => noti.remove(), 500);
        }, tiempo);
    }
    
    let micEnabled = false;
    let recognition;

    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.continuous = false; 
        recognition.interimResults = false;
        recognition.lang = 'es-MX'; 

        recognition.onstart = function() {
            vibrar(60);
            micEnabled = true;
            document.getElementById('mic-toggle').innerText = 'ğŸ”´'; 
            mostrarNotificacion("ğŸ¤ Te escucho...", "#f44336"); 
        };

        recognition.onresult = function(event) {
            vibrar(80);
            const transcript = event.results[0][0].transcript;
            const inputField = document.getElementById('user-input');
            inputField.value = inputField.value ? inputField.value + ' ' + transcript : transcript;
        };

        recognition.onerror = function(event) {
            vibrar([50, 50, 50]);
            mostrarNotificacion("âš ï¸ Error al escuchar. Checa tus permisos.", "#f44336");
        };

        recognition.onend = function() {
            micEnabled = false;
            document.getElementById('mic-toggle').innerText = 'ğŸ¤'; 
        };
    }

    function toggleMic() {
        if (!recognition) { alert("Tu navegador no soporta voz. Usa Chrome o Safari."); return; }
        if (micEnabled) recognition.stop();
        else recognition.start();
    }

    window.addEventListener('DOMContentLoaded', async () => {
        const savedTheme = localStorage.getItem('regina_theme');
        if (savedTheme === 'dark') { document.documentElement.setAttribute('data-theme', 'dark'); } 
        else if (savedTheme === 'sepia') { document.documentElement.setAttribute('data-theme', 'sepia'); }

        let insigniasG = parseInt(localStorage.getItem('regina_total_insignias') || 0);
        if (insigniasG >= 0) { 
            document.getElementById('trofeo-badge').style.display = 'flex';
            document.getElementById('trofeo-count').innerText = insigniasG + "/5";
        }

        const storedUserId = localStorage.getItem('regina_user_id');
        if (!storedUserId) { localStorage.setItem('regina_user_id', 'user_' + Math.floor(Math.random() * 10000000)); }

        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('status') === 'approved') {
            window.history.replaceState({}, document.title, window.location.pathname);
            const chatBox = document.getElementById('chat-box');
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            try {
                const response = await fetch(`${API_URL}/chat`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: "__PAGO_CONFIRMADO__", user_id: getUserId() })
                });
                const data = await response.json();
                loading.style.display = 'none';
                if (data.response) {
                    const newMsg = document.createElement("div");
                    newMsg.className = "message bot-message";
                    chatBox.appendChild(newMsg);
                    typeEffect(newMsg, data.response);
                }
            } catch (e) { loading.style.display = 'none'; }
        }
    });

    function toggleTheme() {
        const body = document.documentElement;
        const currentTheme = body.getAttribute('data-theme');
        if (currentTheme === 'dark') {
            body.setAttribute('data-theme', 'sepia');
            localStorage.setItem('regina_theme', 'sepia');
        } else if (currentTheme === 'sepia') {
            body.removeAttribute('data-theme');
            localStorage.setItem('regina_theme', 'light');
        } else {
            body.setAttribute('data-theme', 'dark');
            localStorage.setItem('regina_theme', 'dark');
        }
    }

    function abrirMiCuenta() {
        const modal = document.getElementById('auth-modal');
        const titulo = modal.querySelector('h2');
        document.getElementById('auth-error').innerText = ""; 
        if (localStorage.getItem('regina_registrado') === 'true') {
            titulo.innerText = "Mi Cuenta VIP ğŸ’";
            document.getElementById('auth-inputs').style.display = 'none';
            document.getElementById('logged-in-view').style.display = 'block';
            if (localStorage.getItem('regina_is_admin') === 'true') { document.getElementById('btn-centro-mando').style.display = 'block'; } 
            else { document.getElementById('btn-centro-mando').style.display = 'none'; }
        } else {
            titulo.innerText = "Acceso al Rancho ğŸ¤ ";
            document.getElementById('auth-inputs').style.display = 'block';
            document.getElementById('logged-in-view').style.display = 'none';
        }
        modal.style.display = 'flex';
    }

    function cerrarSesion() {
        localStorage.removeItem('regina_registrado');
        localStorage.removeItem('regina_user_id');
        localStorage.removeItem('regina_total_insignias'); 
        mostrarNotificacion("ğŸšª SesiÃ³n cerrada. Â¡Nos vemos pronto!", "#f44336");
        setTimeout(() => { window.location.reload(); }, 1200);
    }
    
    async function canjearCupon() {
        const codigo = document.getElementById('input-cupon').value;
        if(!codigo) { vibrar([50, 50, 50]); return; }
        try {
            const response = await fetch(`${API_URL}/canjear_codigo`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: getUserId(), codigo: codigo })
            });
            const data = await response.json();
            if (response.ok) {
                vibrar([50, 100, 50, 100]);
                mostrarNotificacion(data.message, "#4caf50", 5000);
                document.getElementById('input-cupon').value = "";
            } else { vibrar([50, 50, 50]); mostrarNotificacion(data.error, "#f44336", 4000); }
        } catch (e) {}
    }
    
    async function eliminarCuentaPropia() {
        vibrar(100);
        if(!confirm("âš ï¸ Â¿Seguro que quieres borrar tu cuenta?")) return;
        try {
            const response = await fetch(`${API_URL}/eliminar_cuenta`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ user_id: getUserId() })
            });
            if (response.ok) {
                localStorage.removeItem('regina_registrado');
                localStorage.removeItem('regina_user_id');
                localStorage.removeItem('regina_is_admin');
                localStorage.removeItem('regina_total_insignias');
                window.location.reload();
            }
        } catch (e) {}
    }

    function obtenerDatosAuth() {
        return {
            email: document.getElementById('auth-email').value,
            password: document.getElementById('auth-password').value,
            user_id: localStorage.getItem('regina_user_id') 
        };
    }

    async function ejecutarRegistro() {
        const terminos = document.getElementById('auth-terminos').checked;
        const errorMsg = document.getElementById('auth-error');
        if (!terminos) { vibrar([50,50,50]); errorMsg.innerText = "âš ï¸ Acepte los TÃ©rminos."; return; }

        const authDatos = obtenerDatosAuth();
        errorMsg.innerText = "Registrando...";
        try {
            const response = await fetch(`${API_URL}/registro`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(authDatos)
            });
            const data = await response.json();
            if (response.ok) {
                vibrar([50, 100, 50, 100]);
                localStorage.setItem('regina_registrado', 'true');
                localStorage.setItem('regina_user_id', data.user_id);
                localStorage.setItem('regina_is_admin', 'false'); 
                document.getElementById('auth-modal').style.display = 'none';
                mostrarNotificacion("âœ… Â¡Cuenta lista!", "#4caf50");
            } else { vibrar([50,50,50]); errorMsg.innerText = data.error; }
        } catch (e) { vibrar([50,50,50]); }
    }

    async function ejecutarLogin() {
        const authDatos = obtenerDatosAuth();
        const errorMsg = document.getElementById('auth-error');
        errorMsg.innerText = "Entrando...";
        try {
            const response = await fetch(`${API_URL}/login`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(authDatos)
            });
            const data = await response.json();
            if (response.ok) {
                vibrar([50, 100, 50]);
                localStorage.setItem('regina_registrado', 'true');
                localStorage.setItem('regina_user_id', data.user_id);
                localStorage.setItem('regina_is_admin', data.is_admin ? 'true' : 'false');
                errorMsg.innerText = ""; 
                document.getElementById('auth-modal').style.display = 'none';
                mostrarNotificacion("âœ… Â¡SesiÃ³n iniciada!", "#4caf50");
                
                if (data.puntos !== undefined) actualizarInsigniasVisuales(data.puntos);
            } else { vibrar([50,50,50]); errorMsg.innerText = data.error; }
        } catch (e) {}
    }

    function getUserId() { return localStorage.getItem('regina_user_id'); }

    function toggleVoice() {
        vibrar(60);
        if (!voiceEnabled) {
            voiceEnabled = true;
            if (premiumVoiceEnabled) { togglePremiumVoice(); } 
            cargarVoces();
            mostrarNotificacion("ğŸ¤– Voz robÃ³tica activada", "#2196f3");
            hablar("Voz robÃ³tica activada.");
        } else {
            voiceEnabled = false;
            window.speechSynthesis.cancel();
            mostrarNotificacion("ğŸ¤« Silencio activado", "#9e9e9e");
        }
    }

    function togglePremiumVoice() {
        const btnPremium = document.getElementById('btn-header-voice'); 
        if (!premiumVoiceEnabled) {
            premiumVoiceEnabled = true;
            if(btnPremium) btnPremium.innerHTML = '<div style="display:flex; flex-direction:column; align-items:center; line-height:1.1;"><span style="font-size:1.2rem;">ğŸ—£ï¸</span><span style="font-size:0.65rem;">ğŸ’</span></div>'; 
            if (voiceEnabled) { toggleVoice(); } 
            mostrarNotificacion("âœ¨ Voz Premium HD Activada", "#ffca28");
        } else {
            premiumVoiceEnabled = false;
            if(btnPremium) btnPremium.innerHTML = '<div style="display:flex; flex-direction:column; align-items:center; line-height:1.1;"><span style="font-size:1.2rem;">ğŸ¤«</span><span style="font-size:0.65rem; filter:grayscale(100%);">ğŸ’</span></div>'; 
            if (audioPremiumActual) audioPremiumActual.pause();
            mostrarNotificacion("ğŸ¤« Voz Premium Desactivada", "#9e9e9e");
        }
    }

    function cargarVoces() {
        let voces = window.speechSynthesis.getVoices();
        reginaVoice = voces.find(voz => voz.lang.includes('es-MX') && voz.name.includes('Mujer')) || voces.find(voz => voz.lang.includes('es-MX')) || voces.find(voz => voz.lang.includes('es'));
    }
    window.speechSynthesis.onvoiceschanged = cargarVoces;

    function hablar(texto) {
        if (!voiceEnabled) return;
        window.speechSynthesis.cancel(); 
        let textoLimpio = silenciarAviso(texto); 
        const utterance = new SpeechSynthesisUtterance(textoLimpio);
        if (reginaVoice) utterance.voice = reginaVoice;
        utterance.lang = 'es-MX'; utterance.rate = 1.05; 
        window.speechSynthesis.speak(utterance);
    }

    function imprimirGuia(elementId) {
        const mensajeElement = document.getElementById(elementId);
        mensajeElement.classList.add('printable-guide');
        window.print();
        mensajeElement.classList.remove('printable-guide');
    }

    function typeEffect(element, text, speed = 18) {
        let i = 0;
        element.innerHTML = "";
        element.setAttribute('data-original', text); 
        element.setAttribute('data-puretext', text); 
        const msgId = 'msg_' + Date.now();
        element.id = msgId;

        let textoAEscribir = lsmEnabled ? quitarAcentos(text) : text;
        hablar(text); 

        function typing() {
            if (i < textoAEscribir.length) {
                element.innerHTML += textoAEscribir.charAt(i);
                i++;
                setTimeout(typing, speed);
                const chatBox = document.getElementById('chat-box');
                chatBox.scrollTop = chatBox.scrollHeight;
            } else {
                vibrar([50, 100, 50]);

                let copyBtn = `<button onclick="copiarConsejo('${msgId}')" style="background:none; border:1px solid #d81b60; color:#d81b60; border-radius:15px; padding:6px 14px; cursor:pointer; font-size:1rem; font-weight:bold;">ğŸ“‹ Copiar</button>`;
                let readBtn = `<button onclick="reproducirMensaje('${msgId}')" style="background:none; border:1px solid #2196f3; color:#2196f3; border-radius:15px; padding:6px 14px; margin-left:8px; cursor:pointer; font-size:1rem; font-weight:bold;">ğŸ”Š Escuchar</button>`;
                
                let califBtns = `
                    <button id="btn-up-${msgId}" onclick="calificarMensaje('${msgId}', 'up')" style="background:none; border:none; cursor:pointer; font-size:1.5em; margin-left:15px; transition:0.2s; filter:grayscale(0%);" title="Â¡Buen consejo!">ğŸ‘</button>
                    <button id="btn-down-${msgId}" onclick="calificarMensaje('${msgId}', 'down')" style="background:none; border:none; cursor:pointer; font-size:1.5em; margin-left:5px; transition:0.2s; filter:grayscale(0%);" title="No me sirviÃ³">ğŸ‘</button>`;
                
                let botonesAccion = `<br><div style="margin-top:10px; display:flex; align-items:center; flex-wrap:wrap;">${copyBtn}${readBtn}<div style="margin-left:auto;">${califBtns}</div></div>`;

                if (textoAEscribir.length > 600 && (textoAEscribir.includes('Guia') || textoAEscribir.includes('paso a paso') || textoAEscribir.includes('1.'))) {
                    let btnHTML = `<br>
                    <div style="display:flex; gap:10px; margin-top:10px; flex-wrap:wrap;">
                        <button class="pdf-btn" onclick="vibrar(60); imprimirGuia('${msgId}')">ğŸ“„ Guardar PDF Simple</button>
                        <button class="pdf-btn" style="background:#ffca28; color:black; border:2px solid #ffb300;" id="btn-ilustrar-${msgId}" onclick="vibrar(60); ilustrarManual('${msgId}')">âœ¨ Ilustrar Manual (VIP)</button>
                    </div>`;
                    element.innerHTML += btnHTML + botonesAccion;
                    element.setAttribute('data-original', text + btnHTML + botonesAccion);
                } else {
                    element.innerHTML += botonesAccion;
                    element.setAttribute('data-original', text + botonesAccion);
                }
            }
        }
        typing();
    }
    
    async function ilustrarManual(msgId) {
        const mensajeElement = document.getElementById(msgId);
        const btn = document.getElementById(`btn-ilustrar-${msgId}`);
        btn.innerText = "âœ¨ Creando ilustraciÃ³n... (Espere unos 10 seg)";
        btn.disabled = true;

        try {
            const textoGuia = mensajeElement.innerText;
            const response = await fetch(`${API_URL}/ilustrar`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ texto: textoGuia })
            });
            const data = await response.json();

            if (data.imagen_b64) {
                vibrar([50, 50, 50]); 
                const imgHTML = `<br><img src="data:image/jpeg;base64,${data.imagen_b64}" alt="IlustraciÃ³n Premium" style="width:100%; max-width:90%; border-radius:12px; border:3px solid #ffca28; margin:15px auto; box-shadow:0 4px 8px rgba(0,0,0,0.2); display:block;">`;
                btn.parentElement.insertAdjacentHTML('beforebegin', imgHTML);
                const currentOriginal = mensajeElement.getAttribute('data-original');
                if(currentOriginal) { mensajeElement.setAttribute('data-original', currentOriginal + imgHTML); }
                btn.style.display = 'none'; 
                hablar("Â¡Listo pariente! Su manual ha sido ilustrado.");
            } else {
                btn.innerText = "âœ¨ Reintentar IlustraciÃ³n";
                btn.disabled = false;
            }
        } catch (e) {
            btn.innerText = "âœ¨ Reintentar IlustraciÃ³n";
            btn.disabled = false;
        }
    }
    
    async function enviarSugerencia() {
        const texto = document.getElementById('feedback-texto').value;
        const btn = document.getElementById('btn-enviar-sug');
        if (!texto.trim()) { vibrar([50,50,50]); return; }
        btn.innerText = "Enviando... â³";
        btn.disabled = true;
        
        try {
            const response = await fetch(`${API_URL}/feedback`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ user_id: getUserId(), mensaje: texto })
            });
            if (response.ok) {
                vibrar([50, 100, 50]);
                mostrarNotificacion("âœ… Â¡Mensaje recibido! Gracias.", "#4caf50", 5000);
                document.getElementById('feedback-modal').style.display = 'none';
                document.getElementById('feedback-texto').value = '';
            }
        } catch (e) {}
        btn.innerText = "Enviar Mensaje ğŸš€";
        btn.disabled = false;
    }
    
    async function sendMessage() {
        const input = document.getElementById('user-input');
        const message = input.value;
        const chatBox = document.getElementById('chat-box');
        const loading = document.getElementById('loading');
        const userId = getUserId(); 

        if (!message) return;

        let displayMessage = lsmEnabled ? quitarAcentos(message) : message;
        chatBox.innerHTML += `<div class="message user-message" data-original="${message}">${displayMessage}</div>`;
        input.value = '';
        chatBox.scrollTop = chatBox.scrollHeight;
        loading.style.display = 'block';

        try {
            const response = await fetch(`${API_URL}/chat`, { 
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: message, user_id: userId, premium_voice: premiumVoiceEnabled, imagen_b64: imagenChatBase64 }) 
            });

            imagenChatBase64 = null;
            document.getElementById('input-foto-chat').value = '';
            
            const data = await response.json();
            loading.style.display = 'none';

            if (data.status === 'quota_exceeded') {
                vibrar([50, 100, 50, 100, 50]); 
                if (!localStorage.getItem('regina_registrado')) {
                    document.getElementById('auth-modal').style.display = 'flex';
                } else {
                    const modalHtml = `
                    <div id="modal-premium" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; display:flex; justify-content:center; align-items:center;">
                        <div style="background:white; padding:30px; border-radius:20px; max-width:90%; width:400px; text-align:center; box-shadow:0 10px 25px rgba(0,0,0,0.5); border-top: 6px solid #d81b60;">
                            <h2 style="color:#d81b60; margin-top:0;">Â¡Tiempo Fuera, Pariente! ğŸ›‘</h2>
                            <p style="color:#333; font-size:1.1em; font-weight:bold;">Se nos acabaron los mensajes de prueba.</p>
                            <a href="${data.payment_link_day}" style="display:block; background:#ffca28; color:#333; text-decoration:none; padding:15px; border-radius:12px; font-weight:bold; margin-bottom:12px; font-size:1.1em; box-shadow:0 4px 6px rgba(0,0,0,0.1);">ğŸ¤  Pase 24 Horas - $39 MXN</a>
                            <a href="${data.payment_link_month}" style="display:block; background:#d81b60; color:white; text-decoration:none; padding:15px; border-radius:12px; font-weight:bold; margin-bottom:20px; font-size:1.1em; box-shadow:0 4px 6px rgba(0,0,0,0.1);">ğŸ’ Mes VIP Ilimitado - $99 MXN</a>
                            <button onclick="document.getElementById('modal-premium').remove()" style="background:none; border:none; color:#999; text-decoration:underline; cursor:pointer; font-size:1em;">Cerrar por ahora</button>
                        </div>
                    </div>`;
                    document.body.insertAdjacentHTML('beforeend', modalHtml);
                }
            } else if (data.response) {
                const newMsg = document.createElement("div");
                newMsg.className = "message bot-message";
                chatBox.appendChild(newMsg);
                typeEffect(newMsg, data.response); 
                
                if (data.response.includes("Jefe Supremo detectado")) { 
                    localStorage.setItem('regina_is_admin', 'true'); 
                    localStorage.setItem('regina_registrado', 'true');
                    setTimeout(() => {
                        vibrar([50,100,50,100]);
                        abrirMiCuenta();
                    }, 2000);
                }
                if (data.audio) {
                    if (audioPremiumActual) audioPremiumActual.pause();
                    audioPremiumActual = new Audio("data:audio/mp3;base64," + data.audio);
                    audioPremiumActual.play();
                }
                
                if (data.puntos !== undefined) { actualizarInsigniasVisuales(data.puntos); }
            }
        } catch (error) { loading.style.display = 'none'; }
    }

    document.getElementById("user-input").addEventListener("keypress", function(event) {
        if (event.key === "Enter") { vibrar(80); sendMessage(); }
    });

    function sendChip(texto) {
        document.getElementById('user-input').value = texto;
        sendMessage();
    }
    
    let imagenChatBase64 = null;
    function previsualizarFotoChat() {
        const file = document.getElementById('input-foto-chat').files[0];
        if(file) {
            const reader = new FileReader();
            reader.onloadend = function() {
                imagenChatBase64 = reader.result;
                vibrar([50, 100, 50]);
                mostrarNotificacion("ğŸ“¸ Â¡Foto adjuntada exitosamente!<br>Agrega una descripciÃ³n y dale a Enviar.", "#4caf50", 4500);
            }
            reader.readAsDataURL(file);
        }
    }

    function toggleLupa() {
        vibrar(60);
        document.body.classList.toggle('large-text-mode');
        mostrarNotificacion(document.body.classList.contains('large-text-mode') ? "ğŸ” Texto sÃºper grande activado" : "TamaÃ±o restaurado", "#4caf50");
    }

    function toggleContraste() {
        vibrar(60);
        document.body.classList.toggle('high-contrast-mode');
        mostrarNotificacion(document.body.classList.contains('high-contrast-mode') ? "ğŸŒ— Alto contraste activado" : "Colores restaurados", "#4caf50");
    }

    function dispararEmergencia() {
        const chatBox = document.getElementById('chat-box');
        chatBox.innerHTML += `<div class="message user-message" style="background:#d32f2f; color:white; font-weight:bold;">ğŸ§‘â€âš•ï¸ Consulta de Urgencia</div>`;
        const warningHTML = `Â¡ATENCIÃ“N! ğŸ§‘â€âš•ï¸ No soy un mÃ©dico veterinario, soy una IA experta en comportamiento.<br><br>Si tu mascota sufriÃ³ un accidente grave o presenta una condiciÃ³n crÃ­tica, <strong>ESTO REQUIERE ATENCIÃ“N PROFESIONAL INMEDIATA</strong>.<br><br>ğŸ“ <a href="https://www.google.com/maps/search/veterinaria+24+horas" target="_blank" style="color:#d32f2f; font-weight:900; text-decoration:underline;">Haz clic aquÃ­ para buscar veterinarias en Maps</a>.`;
        
        const newMsg = document.createElement("div");
        newMsg.className = "message bot-message";
        newMsg.style.border = "2px solid #d32f2f";
        newMsg.style.background = "rgba(211, 47, 47, 0.1)"; 
        newMsg.innerHTML = warningHTML;
        chatBox.appendChild(newMsg);
        
        if (typeof hablar === "function") { hablar("AtenciÃ³n. Lleva a tu mascota a una clÃ­nica veterinaria inmediatamente."); }
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function descargarHistorial() {
        vibrar(60);
        const mensajes = document.querySelectorAll('.message');
        if(mensajes.length <= 1) { return; }
        
        let textoHistorial = "ğŸ¾ HISTORIAL DE CONSULTA - REGINA VALENTINA ğŸ¾\nFecha: " + new Date().toLocaleString() + "\n---------------------------------------------------\n\n";
        
        mensajes.forEach(msg => {
            let emisor = msg.classList.contains('user-message') ? "TÃš:" : "REGINA:";
            let contenido = msg.getAttribute('data-puretext') || msg.innerText.split('ğŸ“‹')[0].trim();
            textoHistorial += `${emisor}\n${contenido}\n\n`;
        });
        
        const blob = new Blob([textoHistorial], { type: 'text/plain;charset=utf-8' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Consulta_Regina.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        document.getElementById('settings-modal').style.display='none';
    }

    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        document.getElementById('btn-install-app').style.display = 'block';
    });

    function instalarApp() {
        vibrar(60);
        if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') { document.getElementById('btn-install-app').style.display = 'none'; }
                deferredPrompt = null;
            });
        }
    }
</script>

<div style="text-align:center; margin-top:25px; margin-bottom: 15px;">
    <a href="https://RenatoRobles.pythonanywhere.com/blog" target="_blank" onclick="vibrar(60)" style="background: linear-gradient(145deg, #00bcd4, #0097a7); color: white; padding: 14px 28px; border-radius: 25px; text-decoration: none; font-weight: bold; font-size: 1.2em; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: inline-block; transition: 0.3s;">
        ğŸ“ Leer el Blog de la Experta
    </a>
</div>
    
<div class="footer">
    <button onclick="vibrar(60); document.getElementById('feedback-modal').style.display='flex'" style="background:none; border:none; color:#6a1b9a; cursor:pointer; font-size:1.1em; text-decoration:underline; font-weight:bold; margin-bottom:15px;">ğŸ’¡ Dejar una Sugerencia RÃ¡pida</button>
    <p>Â© 2026 <b>Robles Bienestar</b>. Todos los derechos reservados.</p>
    <p><a href="terminos.html" target="_blank">Ver TÃ©rminos y Condiciones Completos</a></p>
    <div id="caja-aviso-legal">
        <p>âš ï¸ <strong>AVISO LEGAL:</strong> Regina Valentina es una IA con fines educativos. Robles Bienestar no se responsabiliza por el uso en seres humanos. <strong>SIN ASESORÃA MÃ‰DICA:</strong> No recetamos medicamentos. El usuario asume la total responsabilidad legal. Ante emergencias, acuda a una clÃ­nica inmediatamente.</p>
    </div>
</div> 

<button onclick="vibrar(60); compartirApp()" class="share-bubble" title="Compartir App">ğŸ“¤</button>

<a href="mailto:soporte@reginavalentina.com?subject=Ayuda%20con%20Regina%20Valentina" onclick="vibrar(60)" class="support-btn" title="Contactar Soporte">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="32" height="32" fill="white">
        <path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"/>
    </svg>
</a>

<div id="settings-modal" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:2000; justify-content:center; align-items:center; display:none;">
    <div style="background:white; padding:30px; border-radius:15px; width:85%; max-width:320px; text-align:center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); position:relative; border-top: 6px solid #6a1b9a;">
        <button onclick="document.getElementById('settings-modal').style.display='none'; vibrar(60);" style="position:absolute; top:10px; right:15px; background:none; border:none; font-size:2em; color:#999; cursor:pointer;">Ã—</button>
        
        <h3 style="color:#6a1b9a; margin-top:20px; margin-bottom:5px; padding-right:15px; font-size:1.3em;">âš™ï¸ Herramientas</h3>
        <p style="color:#555; font-size:1em; margin-bottom:20px;">Ajusta tu experiencia.</p>
        
        <button id="btn-install-app" onclick="instalarApp()" class="btn" style="width:100%; margin-bottom:12px; background: linear-gradient(145deg, #ff9800, #f57c00); color:white; font-weight:bold; display:none; font-size:1.15rem; padding:12px; border-radius:8px; border:none;">ğŸ“± Instalar App</button>

        <button onclick="descargarHistorial()" class="btn" style="width:100%; margin-bottom:15px; background:#4caf50; color:white; font-weight:bold; font-size:1.15rem; padding:12px; border-radius:8px; border:none; box-shadow: 0 4px 6px rgba(0,0,0,0.2); cursor:pointer;">ğŸ’¾ Guardar Chat (TXT)</button>
        
        <hr style="border: 1px solid #eee; margin: 15px 0;">

        <div style="display:flex; flex-direction:column; gap: 12px; margin-bottom: 25px;">
            <button id="btn-config-dyslexia" onclick="vibrar(60); toggleDyslexia()" style="background:#f4f4f9; color:#333; border:2px solid #ddd; padding:14px; border-radius:10px; cursor:pointer; font-family:inherit; display:flex; align-items:center; gap:15px; font-weight:bold; transition:0.3s; font-size:1.1rem;">
                <span id="dyslexia-toggle" style="font-size:1.8em;">ğŸ‘“</span> Letra para Dislexia
            </button>
            <button id="btn-config-lsm" onclick="vibrar(60); toggleLSM()" style="background:#f4f4f9; color:#333; border:2px solid #ddd; padding:14px; border-radius:10px; cursor:pointer; font-family:inherit; display:flex; align-items:center; gap:15px; font-weight:bold; transition:0.3s; font-size:1.1rem;">
                <span id="lsm-toggle" style="font-size:1.8em;">ğŸ¤Ÿ</span> DactilologÃ­a
            </button>
            <button id="btn-config-voice" onclick="vibrar(60); toggleVoice()" style="background:#f4f4f9; color:#333; border:2px solid #ddd; padding:14px; border-radius:10px; cursor:pointer; font-family:inherit; display:flex; align-items:center; gap:15px; font-weight:bold; transition:0.3s; font-size:1.1rem;">
                <span id="voice-toggle" style="font-size:1.8em;">ğŸ¤«</span> Voz RobÃ³tica (BÃ¡sica)
            </button>
            <button id="btn-config-lupa" onclick="vibrar(60); toggleLupa()" style="background:#f4f4f9; color:#333; border:2px solid #ddd; padding:14px; border-radius:10px; cursor:pointer; font-family:inherit; display:flex; align-items:center; gap:15px; font-weight:bold; transition:0.3s; font-size:1.1rem;">
                <span style="font-size:1.8em;">ğŸ”</span> Agrandar Letra
            </button>
            <button id="btn-config-contraste" onclick="vibrar(60); toggleContraste()" style="background:#f4f4f9; color:#333; border:2px solid #ddd; padding:14px; border-radius:10px; cursor:pointer; font-family:inherit; display:flex; align-items:center; gap:15px; font-weight:bold; transition:0.3s; font-size:1.1rem;">
                <span style="font-size:1.8em;">ğŸŒ—</span> Alto Contraste
            </button>
        </div>
        
        <button onclick="document.getElementById('settings-modal').style.display='none'; vibrar(60);" style="width:100%; padding:14px; background-color:#d32f2f; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer; font-size:1.15rem;">Cerrar MenÃº</button>
    </div>
</div>

</body> 
</html>